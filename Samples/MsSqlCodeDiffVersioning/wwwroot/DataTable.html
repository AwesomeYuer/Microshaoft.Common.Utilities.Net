<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>MSSQL DataTable JS</title>
    <link rel="stylesheet" type="text/css" href="libs/datatables/DataTables-1.10.18/css/jquery.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="libs/datatables/AutoFill-2.3.0/css/autoFill.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="libs/datatables/Buttons-1.5.2/css/buttons.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="libs/datatables/ColReorder-1.5.0/css/colReorder.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="libs/datatables/FixedColumns-3.2.5/css/fixedColumns.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="libs/datatables/FixedHeader-3.1.4/css/fixedHeader.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="libs/datatables/KeyTable-2.4.0/css/keyTable.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="libs/datatables/Responsive-2.2.2/css/responsive.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="libs/datatables/RowGroup-1.0.3/css/rowGroup.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="libs/datatables/RowReorder-1.2.4/css/rowReorder.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="libs/datatables/Scroller-1.5.0/css/scroller.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="libs/datatables/Select-1.2.6/css/select.dataTables.css" />
    <script src="libs/jQuery/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="libs/datatables/JSZip-2.5.0/jszip.js"></script>
    <script type="text/javascript" src="libs/datatables/pdfmake-0.1.36/pdfmake.js"></script>
    <script type="text/javascript" src="libs/datatables/pdfmake-0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="libs/datatables/DataTables-1.10.18/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="libs/datatables/AutoFill-2.3.0/js/dataTables.autoFill.js"></script>
    <script type="text/javascript" src="libs/datatables/Buttons-1.5.2/js/dataTables.buttons.js"></script>
    <script type="text/javascript" src="libs/datatables/Buttons-1.5.2/js/buttons.colVis.js"></script>
    <script type="text/javascript" src="libs/datatables/Buttons-1.5.2/js/buttons.flash.js"></script>
    <script type="text/javascript" src="libs/datatables/Buttons-1.5.2/js/buttons.html5.js"></script>
    <script type="text/javascript" src="libs/datatables/Buttons-1.5.2/js/buttons.print.js"></script>
    <script type="text/javascript" src="libs/datatables/ColReorder-1.5.0/js/dataTables.colReorder.js"></script>
    <script type="text/javascript" src="libs/datatables/FixedColumns-3.2.5/js/dataTables.fixedColumns.js"></script>
    <script type="text/javascript" src="libs/datatables/FixedHeader-3.1.4/js/dataTables.fixedHeader.js"></script>
    <script type="text/javascript" src="libs/datatables/KeyTable-2.4.0/js/dataTables.keyTable.js"></script>
    <script type="text/javascript" src="libs/datatables/Responsive-2.2.2/js/dataTables.responsive.js"></script>
    <script type="text/javascript" src="libs/datatables/RowGroup-1.0.3/js/dataTables.rowGroup.js"></script>
    <script type="text/javascript" src="libs/datatables/RowReorder-1.2.4/js/dataTables.rowReorder.js"></script>
    <script type="text/javascript" src="libs/datatables/Scroller-1.5.0/js/dataTables.scroller.js"></script>
    <script type="text/javascript" src="libs/datatables/Select-1.2.6/js/dataTables.select.js"></script>
    <script src="libs/splitjs/split.js"></script>
    <script>
        var binded1 = false;
        var binded2 = false;
        function dynamicAjaxBind() {
            var output1 = "#output1";
            var output2 = "#output2";
            if (binded1) {
                if ($.fn.DataTable.isDataTable(output1)) {
                    $(output1).DataTable().clear().destroy();
                    $(output1).html('');
                }
            }
            if (binded2) {
                if ($.fn.DataTable.isDataTable(output2)) {
                    $(output2).DataTable().clear().destroy();
                    $(output2).html('');
                }
            }
            binded1 = false;
            binded2 = false;
            var sql = document.getElementById("ta").value;
            $.ajax({
                type: 'post',
                url: 'http://localhost:5000/api/StoreProcedureExecutor/usp_executesql',
                data: { sql: sql },
                success: function (d) {
                    if (d.Outputs.ResultSets[0].Columns.length > 0) {
                        $(output1).DataTable({
                            destroy: true,
                            //searching: false,
                            dom: "Bfrtip",
                            data: d.Outputs.ResultSets[0].Rows,
                            columns: d.Outputs.ResultSets[0].Columns
                        });
                        binded1 = true;
                    }
                    if (d.DataBaseStatistics.Messages.length > 0) {
                        $(output2).DataTable({
                            destroy: true,
                            //searching: false,
                            dom: "Bfrtip",
                            data: d.DataBaseStatistics.Messages,
                            columns: [
                                //{
                                //    "title": "MessageID",
                                //    "data": "MessageID"
                                //},
                                {
                                    "title": "ResultSetID"
                                    , "data": "ResultSetID"
                                },
                                //{
                                //    "title": "Source",
                                //    "data": "Source"
                                //},
                                {
                                    "title": "Message"
                                    , "data": "Message"
                                },
                                {
                                    "title": "DealTime"
                                    , "data": "DealTime"
                                }
                            ]
                        });
                        binded2 = true;
                    }
                },
                error: function (x, y, z) {
                    d = JSON.parse(x.responseText);
                    $(output2).DataTable({
                        destroy: true,
                        //searching: false,
                        dom: "Bfrtip",
                        data: [d],
                        columns: [
                            {
                                "title": "Message"
                                , "data": "Message"
                            },
                            {
                                "title": "StatusCode"
                                , "data": "StatusCode"
                            }
                        ]
                    });
                    binded2 = true;
                }
                //contentType: "application/json",
                //dataType: 'json',
            });
        }
        //debugger;
    </script>
    <style>
        html,
        body {
            height: 100%;
        }
        body {
            padding: 8px;
            background-color: #F6F6F6;
            box-sizing: border-box;
        }
        .split {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .content {
            border: 1px solid #C0C0C0;
            box-shadow: inset 0 1px 2px #e4e4e4;
            background-color: #fff;
        }
        .gutter {
            background-color: transparent;
            background-repeat: no-repeat;
            background-position: 50%;
        }
        .gutter.gutter-horizontal {
            cursor: col-resize;
            background-image: url('../grips/vertical.png');
        }
        .gutter.gutter-vertical {
            cursor: row-resize;
            background-image: url('../grips/horizontal.png');
        }
        .split.split-horizontal,
        .gutter.gutter-horizontal {
            height: 100%;
            float: left;
        }
    </style>
</head>
<body>
    <div id="up" class="split content" align="center">
        <br />
        <textarea id="ta" rows="5" cols="100">
set statistics io on
set statistics time on
select '""' as F
from
sys.objects

select '""' as F, *
from
sys.objects

        </textarea>
        <button onclick="dynamicAjaxBind()" accesskey="x">E(<b><u>X</u></b>)exute</button>
    </div>
    <div id="down" class="split content" style="overflow:auto">
        Data:<br />
        <table id="output1" class="display">
            <!-- <thead>
            <tr>
                <th>Name</th>
                <th>Position</th>
                <th>Office</th>
                <th>Extn.</th>
                <th>Start date</th>
                <th>Salary</th>
            </tr>
        </thead> -->
        </table>

        <br />
        <hr />
        <br />

        Messages:<br />
        <table id="output2" class="display">
            <!-- <thead>
            <tr>
                <th>Name</th>
                <th>Position</th>
                <th>Office</th>
                <th>Extn.</th>
                <th>Start date</th>
                <th>Salary</th>
            </tr>
        </thead> -->
        </table>
    </div>
    <script>
        Split(['#up', '#down'], {
            gutterSize: 10,
            cursor: 'pointer',
            direction: 'vertical',
            sizes:[20, 80]
        });
    </script>
</body>
</html>